# 批次更新專題多語言關鍵字

此腳本用於為所有現有專題添加英文、日文、韓文關鍵字。

## 功能

- 📊 掃描所有 Supabase 中的專題
- 🔍 識別只有中文關鍵字的專題
- 🌐 自動翻譯成英日韓三語
- 💾 更新資料庫

## 使用方法

### 1. 確保環境變數已設定

確認 `.env` 檔案包含：
```
GEMINI_API_KEY=your_api_key
SUPABASE_URL=your_supabase_url
SUPABASE_SERVICE_KEY=your_service_key
```

### 2. 執行腳本

```bash
# 進入虛擬環境
cd /Users/nightpluie/Desktop/TopicRadar
source venv/bin/activate

# 執行腳本
python3 scripts/batch_translate_topics.py
```

## 預期行為

腳本會：

1. ✅ **掃描所有專題**：讀取 Supabase 中所有使用者的專題
2. ✅ **智慧判斷**：
   - 若關鍵字為舊格式（純陣列），自動轉換並翻譯
   - 若關鍵字已有多語言，跳過
   - 若僅有中文關鍵字，進行翻譯
3. ✅ **更新資料庫**：將翻譯結果寫入 Supabase
4. ✅ **顯示進度**：實時顯示每個專題的處理狀態

## 執行範例

```
============================================================
批次更新專題多語言關鍵字
============================================================

📊 找到 26 個專題

處理專題: 長照政策 (ID: abc123)
  → 僅有中文關鍵字，進行翻譯...
  ✓ 翻譯完成: EN=5, JA=5, KO=5
  ✓ 已更新資料庫

處理專題: 核電爭議 (ID: def456)
  ✓ 已有多語言關鍵字，跳過

============================================================
處理完成！
============================================================
✓ 已更新: 15 個專題
⊘ 已跳過: 10 個專題（已有多語言關鍵字）
✗ 錯誤: 1 個專題
```

## 注意事項

⚠️ **速率限制**：腳本會在每個翻譯請求之間等待 1 秒，避免觸發 Gemini API 速率限制

⚠️ **備份建議**：執行前建議先備份 Supabase 資料庫

⚠️ **API 配額**：大量翻譯可能消耗較多 API 配額，請確認您的 Gemini API 額度充足

## 疑難排解

### 問題：API 速率限制

如果遇到 429 錯誤，腳本會自動重試。若仍失敗，請稍後再執行。

### 問題：翻譯失敗

部分專題可能因網路問題翻譯失敗，您可以重新執行腳本，已翻譯的專題會自動跳過。

### 問題：認證錯誤

確認 `.env` 中的 `SUPABASE_SERVICE_KEY` 具有讀寫 `topics` 表的權限。
